<html>

<head>
    <title>CSC5210 The Pinnacle of Puzzles</title>
</head>

<body>

    <canvas id="myCanvas" width="800" height="600"></canvas>
    <script src="three.js"></script>
    <script src="DragControls.js"></script>

    <script>
        // Create the object to represent a triangle
        var scene = new THREE.Scene();

        var camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, .1, 3000);
        camera.position.z = 100;  // Try moving this around!
        camera.lookAt(new THREE.Vector3(0.0, 0.0, 0.0));
        scene.add(camera);

        var renderer = new THREE.WebGLRenderer({ canvas: myCanvas, antialias: true, alpha: true });
        renderer.setClearColor(0xffffff);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);

        const material = new THREE.LineBasicMaterial({ color: 0x000000 });

        const points = [];
        points.push(new THREE.Vector3(-12.5, -12.5, 0));
        points.push(new THREE.Vector3(12.5, -12.5, 0));
        points.push(new THREE.Vector3(12.5, 12.5, 0));
        points.push(new THREE.Vector3(-12.5, 12.5, 0));
        points.push(new THREE.Vector3(-12.5, -12.5, 0));

        const geometry = new THREE.BufferGeometry().setFromPoints(points);
        const line = new THREE.Line(geometry, material);
        scene.add(line);

        function getRndInteger(min, max) {
            return Math.floor(Math.random() * (max - min)) + min;
        }

        // The "Frame-per-second" loop
        function animate() {
            requestAnimationFrame(animate);
            render();
        }

        function render() {
            renderer.render(scene, camera);
        }

        // Initiate the graphical loop
        animate();

        var triangles = [];
        var i = 0;
        while (i < 50) {
            const baseTriangle = new THREE.BufferGeometry();

            var x1 = getRndInteger(-30, 30);
            var y1 = getRndInteger(-30, 25);
            var x2 = x1 + 3;//getRndInteger(x1 + 1, 30);
            var y2 = y1;//getRndInteger(-20, 0);
            var x3 = (x2 + x1) / 2;//getRndInteger(x1, y1) * 0.5;
            var y3 = y1 + 5;//getRndInteger(y2, 20) * 0.5;
            var z = 0;

            var vertices = new Float32Array([
                x1, y1, z,
                x2, y2, z,
                x3, y3, z,
            ]);

            baseTriangle.setAttribute('position', new THREE.BufferAttribute(vertices, 3));
            var _material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
            var mesh = new THREE.Mesh(baseTriangle, _material);

            //check for intersections
            var draw = true;
            for (let j = 0; j < triangles.length; j++) {
                var checkBox = triangles[j];
                firstBB = new THREE.Box3().setFromObject(mesh);
                secondBB = new THREE.Box3().setFromObject(checkBox);
                var collision = firstBB.intersectsBox(secondBB);
                if (collision) {
                    draw = false;
                }
            }
            // dont add the triangle if it hits any others
            if (draw) {
                scene.add(mesh);
                triangles.push(mesh);
                i++;
            }
        }

        var controls = new THREE.DragControls(triangles, camera, renderer.domElement);
        var color;
        controls.addEventListener('dragstart', function (event) {
            event.object.material.opacity = 0.5
        })
        controls.addEventListener('dragend', function (event) {
            event.object.material.opacity = 1
        })

    </script>
</body>

</html>